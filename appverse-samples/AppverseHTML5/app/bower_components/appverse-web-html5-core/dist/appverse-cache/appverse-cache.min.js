/*! appverse-web-html5-core - v0.5.0-dev - */
!function(){"use strict";function a(a,b,c){a.info("appverse.cache run"),c.ScopeCache_Enabled&&b.setScopeCache(c.ScopeCache_duration,c.ScopeCache_capacity),c.BrowserStorageCache_Enabled&&b.setBrowserStorage(c.BrowserStorage_type,c.MaxAge,c.CacheFlushInterval,c.DeleteOnExpire,c.VerifyIntegrity),c.HttpCache_Enabled&&b.setDefaultHttpCacheStorage(c.HttpCache_duration,c.HttpCache_capacity)}angular.module("appverse.cache",["ng","appverse.configuration","jmdobry.angular-cache","ngResource"]).run(a),a.$inject=["$log","CacheFactory","CACHE_CONFIG"]}(),function(){"use strict";angular.module("appverse.cache").directive("cache",["$log","CacheFactory",function(a,b){return{link:function(c,d,e){var f=e.cache||e.cacheName;c.$watch(function(){return b.getScopeCache().get(f)},function(d){a.debug("Cache watch {"+f+"}:",d),c[f]=b.getScopeCache().get(f)}),c.$watch(f,function(d){a.debug("Cache watch {"+f+"}:",d),b.getScopeCache().put(f,c[f])})}}}])}(),function(){"use strict";function a(a,b,c){var d={_scopeCache:null,_browserCache:null,_httpCache:null};return d.setScopeCache=function(b,e){return d._scopeCache=a(c.DefaultScopeCacheName,{maxAge:b,capacity:e}),d._scopeCache},d.getScopeCache=function(){return d._scopeCache||d.setScopeCache(c.ScopeCache_duration,c.ScopeCache_capacity)},d.setBrowserStorage=function(b,e,f,g,h){var i;return i="2"==b?c.SessionBrowserStorage:c.LocalBrowserStorage,d._browserCache=a(c.DefaultBrowserCacheName,{maxAge:e,cacheFlushInterval:f,deleteOnExpire:g,storageMode:i,verifyIntegrity:h}),d._browserCache},d.setDefaultHttpCacheStorage=function(c,e){var f="MyHttpAngularCache";return d._httpCache=a.get(f),d._httpCache?d._httpCache.setOptions({capacity:e,maxAge:c,deleteOnExpire:"aggressive",recycleFreq:15e3,cacheFlushInterval:15e3,storageMode:"localStorage",verifyIntegrity:!0}):d._httpCache=a(f,{capacity:e,maxAge:c,deleteOnExpire:"aggressive",recycleFreq:15e3,cacheFlushInterval:15e3,verifyIntegrity:!0}),b.defaults.cache=d._httpCache,d._httpCache},d.getHttpCache=function(){return d._httpCache},d}angular.module("appverse.cache").factory("CacheFactory",a),a.$inject=["$angularCacheFactory","$http","CACHE_CONFIG"]}(),function(){"use strict";angular.module("appverse.cache").service("IDBService",["$q","$log",function(a,b){function c(){var c=a.defer();if(e)return c.resolve(!0),c.promise;var f=window.indexedDB.open("indexeddb_appverse",1);return f.onerror=function(a){b.debug("Error opening db"),console.dir(a),c.reject(a.toString())},f.onupgradeneeded=function(a){var b,c=a.target.result;c.objectStoreNames.contains("default")||(b=c.createObjectStore("item",{keyPath:"id",autoIncrement:!0}),b.createIndex("titlelc","titlelc",{unique:!1}),b.createIndex("tags","tags",{unique:!1,multiEntry:!0}))},f.onsuccess=function(a){d=a.target.result,d.onerror=function(a){c.reject("Database error: "+a.target.errorCode)},e=!0,c.resolve(!0)},c.promise}var d,e=!1,f={};return f.isSupported=function(){return"indexedDB"in window},f.deleteDefault=function(b){var c=a.defer(),e=d.transaction(["item"],"readwrite");return e.objectStore("item").delete(b),e.oncomplete=function(){c.resolve()},c.promise},f.getDefault=function(b){var c=a.defer(),e=d.transaction(["item"]),f=e.objectStore("item"),g=f.get(b);return g.onsuccess=function(){var a=g.result;c.resolve(a)},c.promise},f.getDefaults=function(){var b=a.defer();return c().then(function(){var a=[],c=function(b){var c=b.target.result;c&&(a.push({key:c.key,title:c.value.title,body:c.value.body,updated:c.value.updated,tags:c.value.tags}),c.continue())},e=d.transaction(["item"],"readonly"),f=e.objectStore("item");f.openCursor().onsuccess=c,e.oncomplete=function(){b.resolve(a)}}),b.promise},f.ready=function(){return e},f.saveDefault=function(c){var e=a.defer();c.id||(c.id="");var f=c.title.toLowerCase(),g=d.transaction(["item"],"readwrite");return""===c.id?(b.debug("id empty"),g.objectStore("item").add({title:c.title,body:c.body,updated:(new Date).getTime(),titlelc:f,tags:new Array(c.tags)})):(b.debug("id not empty"),g.objectStore("item").put({title:c.title,body:c.body,updated:new Date,id:Number(c.id),titlelc:f,tags:new Array(c.tags)})),g.oncomplete=function(){e.resolve()},e.promise},f.item=function(a,b,c,d){this.id=a,this.title=b,this.body=c,this.tags=d},f}])}();
//# sourceMappingURL=appverse-cache.min.js.map