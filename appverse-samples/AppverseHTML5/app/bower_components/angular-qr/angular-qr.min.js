/*!
 * angular-qr v0.1.4
 * The MIT License
 * Copyright (c) 2013 Jan Antala
 */
!function(a){"use strict";angular.module("ja.qr",[]).controller("QrCtrl",["$scope",function(a){a.getTypeNumeber=function(){return a.typeNumber||0},a.getCorrection=function(){var b={L:1,M:0,Q:3,H:2},c=a.correctionLevel||0;return b[c]||0},a.getText=function(){return a.text||""},a.getSize=function(){return a.size||250},a.isNUMBER=function(a){var b=/^[0-9]*$/;return b.test(a)},a.isALPHA_NUM=function(a){var b=/^[0-9A-Z $%*+\-./:]*$/;return b.test(a)},a.is8bit=function(a){for(var b=0;b<a.length;b++){var c=a.charCodeAt(b);if(c>255)return!1}return!0},a.checkInputMode=function(b,c){if("NUMBER"===b&&!a.isNUMBER(c))throw new Error("The `NUMBER` input mode is invalid for text.");if("ALPHA_NUM"===b&&!a.isALPHA_NUM(c))throw new Error("The `ALPHA_NUM` input mode is invalid for text.");if("8bit"===b&&!a.is8bit(c))throw new Error("The `8bit` input mode is invalid for text.");if(!a.is8bit(c))throw new Error("Input mode is invalid for text.");return!0},a.getInputMode=function(b){var c=a.inputMode;return c=c||(a.isNUMBER(b)?"NUMBER":void 0),c=c||(a.isALPHA_NUM(b)?"ALPHA_NUM":void 0),c=c||(a.is8bit(b)?"8bit":""),a.checkInputMode(c,b)?c:""}}]).directive("qr",["$timeout","$window",function(b,c){return{restrict:"E",template:"<canvas></canvas>",scope:{typeNumber:"=",correctionLevel:"=",inputMode:"=",size:"=",text:"="},controller:"QrCtrl",link:function(d,e){if(void 0===d.text)throw new Error("The `text` attribute is required.");var f=e.find("canvas")[0],g=!!c.CanvasRenderingContext2D;d.TYPE_NUMBER=d.getTypeNumeber(),d.TEXT=d.getText(),d.CORRECTION=d.getCorrection(),d.SIZE=d.getSize(),d.INPUT_MODE=d.getInputMode(d.TEXT);var h=function(a,b,c,d){for(var e=0;c>e;e++)for(var f=0;c>f;f++){var g=Math.ceil((f+1)*d)-Math.floor(f*d),h=Math.ceil((e+1)*d)-Math.floor(e*d);a.fillStyle=b.isDark(e,f)?"#000":"#fff",a.fillRect(Math.round(f*d),Math.round(e*d),g,h)}},i=function(b,c,d,e,f,i){var j=/^\s+|\s+$/g,k=c.replace(j,""),l=new a(d,e,i);l.addData(k),l.make();var m=b.getContext("2d"),n=l.getModuleCount(),o=f/n;b.width=b.height=f,g&&h(m,l,n,o)};i(f,d.TEXT,d.TYPE_NUMBER,d.CORRECTION,d.SIZE,d.INPUT_MODE),b(function(){d.$watch("text",function(a,b){a!==b&&(d.TEXT=d.getText(),d.INPUT_MODE=d.getInputMode(d.TEXT),i(f,d.TEXT,d.TYPE_NUMBER,d.CORRECTION,d.SIZE,d.INPUT_MODE))}),d.$watch("correctionLevel",function(a,b){a!==b&&(d.CORRECTION=d.getCorrection(),i(f,d.TEXT,d.TYPE_NUMBER,d.CORRECTION,d.SIZE,d.INPUT_MODE))}),d.$watch("typeNumber",function(a,b){a!==b&&(d.TYPE_NUMBER=d.getTypeNumeber(),i(f,d.TEXT,d.TYPE_NUMBER,d.CORRECTION,d.SIZE,d.INPUT_MODE))}),d.$watch("size",function(a,b){a!==b&&(d.SIZE=d.getSize(),i(f,d.TEXT,d.TYPE_NUMBER,d.CORRECTION,d.SIZE,d.INPUT_MODE))}),d.$watch("inputMode",function(a,b){a!==b&&(d.INPUT_MODE=d.getInputMode(d.TEXT),i(f,d.TEXT,d.TYPE_NUMBER,d.CORRECTION,d.SIZE,d.INPUT_MODE))})})}}}])}(window.QRCode);